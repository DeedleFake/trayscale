app-id: dev.deedles.Trayscale

runtime: org.gnome.Platform
runtime-version: '43'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang

command: trayscale

finish-args:
  - --socket=wayland
  - --socket=x11
  - --socket=session-bus
  - --device=dri
  - --share=network
  - --share=ipc
  - --filesystem=/run/tailscale

build-options:
  build-args:
    - --share=network
  env:
    - GOROOT=/usr/lib/sdk/golang

modules:
  - name: trayscale
    buildsystem: simple
    build-commands:
      - $GOROOT/bin/go build -v -trimpath -ldflags="-X 'deedles.dev/trayscale/internal/version.version=v0.7.8'" ./cmd/trayscale
      - install -Dm0755 trayscale /app/bin/trayscale
      - install -Dm0644 com.tailscale-tailscale.png /app/share/icons/hicolor/256x256/apps/com.tailscale-tailscale.png
      - install -Dm0644 dev.deedles-trayscale.desktop /app/share/applications/dev.deedles-trayscale.desktop
      - install -Dm0755 tailscale.sh /app/bin/tailscale
    sources:
      - type: archive
        url: https://github.com/DeedleFake/trayscale/archive/refs/tags/v0.7.8.tar.gz
        sha256: a37c80930216ec594e0bec36edf9ce962cc9f30af8a490634bb91cf62da17834
      - type: script
        dest-filename: tailscale.sh
        commands:
          - flatpak-spawn --host tailscale
